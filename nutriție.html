<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>BP · AI Nutriție – Demo Premium PDF</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

<style>
:root{
  --green:#0e5a43; --green-2:#0a4a35; --gold:#c9a227; --text:#1b2a26;
  --muted:#5b6a66; --bg:#f7faf8; --white:#fff; --line:#e7ece8; --r:16px; --shadow:0 10px 30px rgba(0,0,0,.07);
  --max:1160px;
}
*{box-sizing:border-box} html,body{margin:0}
body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);background:var(--white)}
a{color:inherit;text-decoration:none}
.container{max-width:var(--max);margin:0 auto;padding:0 20px}
.kicker{color:var(--gold);text-transform:uppercase;letter-spacing:.12em;font-size:12px;font-weight:800}
.title{font-family:"Playfair Display",serif}
.btn{display:inline-flex;gap:10px;align-items:center;justify-content:center;padding:14px 18px;border-radius:12px;border:1px solid transparent;font-weight:800;cursor:pointer}
.btn-primary{background:var(--green);color:#fff}
.btn-primary:hover{background:var(--green-2)}
.btn-outline{border:1px solid var(--green);color:var(--green);background:#fff}
.badge{display:inline-flex;gap:8px;align-items:center;padding:6px 10px;border:1px solid var(--line);border-radius:999px;color:var(--muted);font-size:12px;background:#fff}

/* Header */
header{position:sticky;top:0;z-index:40;background:rgba(255,255,255,.9);backdrop-filter:blur(8px);border-bottom:1px solid var(--line)}
.nav{height:64px;display:flex;align-items:center;justify-content:space-between}
.logo{display:flex;gap:10px;align-items:center;font-weight:800}
.logo .mark{width:34px;height:34px;border-radius:10px;background:conic-gradient(#0e5a43,#0a4a35);border:2px solid var(--gold);display:grid;place-items:center;color:#fff}
.menu-toggle{display:none;background:none;border:0;font-size:26px;color:var(--green);padding:10px}
.navlinks{display:flex;gap:22px}
.navlinks a{font-weight:600;opacity:.9}
.navlinks a:hover{opacity:1}

/* Hero */
.hero{background:linear-gradient(180deg,#f4fbf6 0%, #ffffff 70%);padding:64px 0 36px;border-bottom:1px solid var(--line)}
.hero .wrap{display:grid;grid-template-columns:1.1fr .9fr;gap:36px;align-items:center}
.hero h1{font-size:clamp(30px,6.2vw,48px);line-height:1.08;margin:.2rem 0 1rem}
.hero p{color:#40524d;font-size:17px}
.visual .card{height:320px;border-radius:22px;background:#fff;border:1px solid var(--line);box-shadow:var(--shadow);display:grid;place-items:center}
.visual .ring{width:70%;height:70%;border-radius:50%;border:10px solid #e9f3ee;border-top-color:#bfe7d6;animation:spin 10s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

/* Sections */
.section{padding:56px 0}
.soft{background:var(--bg)}
.grid3{display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
.card{background:#fff;border:1px solid var(--line);border-radius:var(--r);box-shadow:var(--shadow)}
.step{padding:22px}
.step p{color:var(--muted);margin:0}

/* Pricing */
.pricing-wrap{padding:56px 0}
.pricing-head{display:flex;justify-content:space-between;align-items:end;gap:20px;flex-wrap:wrap}
.pricing-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin-top:18px}
.price-card{background:#fff;border:1px solid var(--line);border-radius:16px;box-shadow:var(--shadow);padding:24px;position:relative;display:flex;flex-direction:column}
.price-card.pro{border:2px solid #cfe9df;box-shadow:0 12px 28px rgba(17,163,127,.12)}
.price-card .pop{position:absolute;right:16px;top:16px;background:var(--gold);color:#fff;padding:6px 10px;border-radius:999px;font-size:12px;font-weight:800}

/* FAQ */
details{background:#fff;border:1px solid var(--line);border-radius:12px;padding:14px 16px}
summary{font-weight:800;cursor:pointer}

/* Footer */
footer{background:#0b1a15;color:#d8eee6;border-top:1px solid #123226;padding:36px 0}
footer a{color:#d8eee6}

/* Modal (wizard) */
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.4);padding:20px;z-index:1000}
.modal.show{display:flex}
.dialog{background:#fff;border:1px solid var(--line);border-radius:16px;box-shadow:var(--shadow);padding:22px;max-width:920px;width:100%}
.stepper{display:flex;gap:8px;margin-bottom:12px}
.stepper .dot{height:8px;flex:1;border-radius:999px;background:#e6efe9}
.stepper .dot.active{background:var(--green)}
.row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
label{display:block;font-weight:700;margin:8px 0 6px}
input,select,textarea{width:100%;padding:12px 14px;border:1px solid var(--line);border-radius:12px;background:#fff}
.actions{display:flex;gap:10px;justify-content:flex-end;margin-top:10px}
.badge.muted{color:var(--muted);background:#fff;border-color:var(--line)}

/* Responsive helpers */
@media (max-width:980px){ .grid3,.row{grid-template-columns:1fr} .hero .wrap{grid-template-columns:1fr} }
@media (max-width:768px){
  .menu-toggle{display:block;margin-left:auto}
  .nav{flex-wrap:wrap}
  .navlinks{display:none;width:100%;flex-direction:column;padding:10px 0;border-top:1px solid var(--line);background:#fff}
  .navlinks.show{display:flex}
  .btn{flex:1}
}
[id]{scroll-margin-top:76px}
html{scroll-behavior:smooth}
</style>
</head>
<body>

<header>
  <div class="container nav">
    <a class="logo" href="/"><span class="mark">BP</span><span>Bucătarul Personal</span></a>
    <button class="menu-toggle" aria-label="Meniu" aria-expanded="false">&#9776;</button>
    <nav class="navlinks">
      <a href="#cum">Cum funcționează</a>
      <a href="#preturi">Prețuri</a>
      <a href="#faq">FAQ</a>
    </nav>
  </div>
</header>

<section class="hero">
  <div class="container wrap">
    <div>
      <div class="kicker">AI Nutriție</div>
      <h1 class="title">Meniuri personalizate cu AI — elegant, echilibrat, pe gustul tău</h1>
      <p>Completezi profilul, AI-ul creează un meniu gourmet pe 7 zile, iar dacă vrei validare umană, poți programa o discuție cu un nutriționist.</p>
      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:14px">
        <button class="btn btn-primary" id="openAi">Generează meniul meu</button>
        <a class="btn btn-outline" href="#preturi">Vezi pachetele</a>
        <span class="badge">5–7 min pentru completare</span>
      </div>
    </div>
    <div class="visual">
      <div class="card"><div class="ring" aria-hidden="true"></div></div>
    </div>
  </div>
</section>

<section id="cum" class="section soft">
  <div class="container grid3">
    <div class="card step">
      <div class="kicker">Pasul 1</div>
      <h3 class="title" style="margin:6px 0 8px">Completezi profilul</h3>
      <p>Alergii, preferințe, obiectiv, calorii/zi și bucătării preferate.</p>
    </div>
    <div class="card step">
      <div class="kicker">Pasul 2</div>
      <h3 class="title" style="margin:6px 0 8px">AI generează meniul</h3>
      <p>3–5 mese/zi, echilibrate nutrițional, cu plating gourmet.</p>
    </div>
    <div class="card step">
      <div class="kicker">Pasul 3</div>
      <h3 class="title" style="margin:6px 0 8px">Primești PDF elegant</h3>
      <p>Meniu pe 7 zile + valori pe zi/porție și listă de cumpărături.</p>
    </div>
  </div>
</section>

<section id="preturi" class="pricing-wrap">
  <div class="container">
    <div class="pricing-head">
      <div>
        <div class="kicker">Pachete</div>
        <h2 class="title" style="margin:6px 0 10px">Alege varianta potrivită</h2>
      </div>
      <span class="badge">Începi gratuit, poți trece la Pro oricând</span>
    </div>

    <div class="pricing-grid">
      <article class="price-card">
        <p class="tier">AI — Basic</p><p class="price">0 RON</p>
        <ul><li>Meniu pe 7 zile (PDF)</li><li>1 revizie automată</li></ul>
        <button class="btn btn-outline" onclick="window.openAIModal && window.openAIModal()">Începe gratuit</button>
      </article>
      <article class="price-card pro">
        <span class="pop">Recomandat</span>
        <p class="tier">AI — Pro</p><p class="price">49 RON</p>
        <ul><li>+ 2 meniuri alternative</li><li>Shopping list inteligent</li><li>Batch-cooking & prep</li></ul>
        <button class="btn btn-primary" onclick="window.openAIModal && window.openAIModal()">Generează Pro</button>
      </article>
      <article class="price-card">
        <p class="tier">Nutriționist</p><p class="price">de la 199 RON</p>
        <ul><li>Video call 30–45 min</li><li>Ajustări personalizate</li></ul>
        <a class="btn btn-outline" href="mailto:contact@bucatarulpersonal.ro">Programează consultanța</a>
      </article>
    </div>
  </div>
</section>

<section id="faq" class="section soft">
  <div class="container" style="display:grid;gap:10px">
    <details><summary>Primesc valorile nutriționale?</summary><p>Da, pe zi și pe porție (calorii + macronutrienți estimativi) în PDF.</p></details>
    <details><summary>Pot exclude alergeni?</summary><p>Da, AI exclude ingredientele bifate; nutriționistul poate valida și ajusta fin.</p></details>
    <details><summary>Pot vorbi întâi cu un specialist?</summary><p>Sigur, rezervi o discuție în pachetul Nutriționist.</p></details>
  </div>
</section>

<section class="section" style="padding-top:32px">
  <div class="container" style="display:flex;gap:12px;flex-wrap:wrap;justify-content:center">
    <button class="btn btn-primary" id="openAi2">Generează meniul meu AI</button>
    <a class="btn btn-outline" href="#preturi">Vezi pachetele</a>
  </div>
</section>

<footer>
  <div class="container" style="display:flex;justify-content:space-between;gap:20px;flex-wrap:wrap">
    <div class="logo"><span class="mark">BP</span><span>Bucătarul Personal</span></div>
    <div><strong>Contact</strong><br><a href="mailto:contact@bucatarulpersonal.ro">contact@bucatarulpersonal.ro</a></div>
    <div><strong>Legal</strong><br><a href="/termeni">Termeni & Condiții</a></div>
  </div>
</footer>

<!-- jsPDF + AutoTable -->
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>

<script>
/* ================= NAV burger ================= */
document.addEventListener('DOMContentLoaded', () => {
  const t=document.querySelector('.menu-toggle'), n=document.querySelector('.navlinks');
  if(t&&n){
    const close=()=>{n.classList.remove('show'); t.setAttribute('aria-expanded','false');};
    t.addEventListener('click',()=>{const o=!n.classList.contains('show'); n.classList.toggle('show',o); t.setAttribute('aria-expanded',o?'true':'false');});
    n.querySelectorAll('a').forEach(a=>a.addEventListener('click',close));
  }
});

/* ================= MODAL & WIZARD ================= */
const modal=document.getElementById('aiModal');
const openAi=document.getElementById('openAi');
const openAi2=document.getElementById('openAi2');
const closeAi=document.getElementById('closeAi');

function openAIModal(){ modal.classList.add('show'); goToStep(1); }
window.openAIModal = openAIModal;
openAi?.addEventListener('click',openAIModal);
openAi2?.addEventListener('click',openAIModal);
closeAi?.addEventListener('click',()=> modal.classList.remove('show'));
modal.addEventListener('click',e=>{ if(e.target===modal) modal.classList.remove('show'); });

const form=document.getElementById('aiForm');
const statusB=document.getElementById('aiStatus');
const prevBtn=document.getElementById('prevBtn');
const nextBtn=document.getElementById('nextBtn');
const submit=document.getElementById('submitBtn');
const steps=Array.from(form.querySelectorAll('[data-step]'));
const dots=Array.from(document.querySelectorAll('.stepper .dot'));
let current=1;

function goToStep(n){
  const total=steps.length; current=Math.max(1,Math.min(total,n));
  steps.forEach((s,i)=> s.hidden=(i!==current-1));
  dots.forEach((d,i)=> d.classList.toggle('active',i<current));
  prevBtn.disabled=current===1; nextBtn.hidden=current===total; submit.hidden=current!==total;
  statusB.textContent=''; steps[current-1].querySelector('input,select,textarea')?.focus();
}

function validateStep(n){
  if(n===1){
    const nume=form.querySelector('#nume'), email=form.querySelector('#email');
    if(!nume.value.trim()) return 'Te rugăm să completezi numele.';
    if(!email.validity.valid) return 'Te rugăm să introduci un email valid.';
  }
  if(n===3 && !document.getElementById('gdpr').checked) return 'Trebuie să îți dai acordul pentru prelucrarea datelor.';
  return '';
}

prevBtn.addEventListener('click',()=> goToStep(current-1));
nextBtn.addEventListener('click',()=>{
  const err=validateStep(current); if(err){ statusB.textContent=err; return; }
  const total=steps.length; if(current<total){ current++; goToStep(current); } else submit.click();
});
form.addEventListener('keydown',(e)=>{ if(e.key==='Enter' && submit.hidden){ e.preventDefault(); nextBtn.click(); }});

/* ================= API + FALLBACK PDF ================= */
const API_URL = '/api/ai-menu'; // dacă nu ai backend, fallback-ul PDF funcționează local

form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  const err=validateStep(3);
  if(err){ statusB.textContent=err; return; }

  [prevBtn,nextBtn,submit].forEach(b=> b && (b.disabled=true));
  submit.classList.add('is-loading');
  statusB.textContent='Se generează…';

  const formData=Object.fromEntries(new FormData(form).entries());
  const payload={ form:formData, source:'bp-modal' };

  try{
    const r=await fetch(API_URL,{ method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload) });
    let j={}; try{ j=await r.json(); }catch{}
    if(r.ok && j.ok){
      statusB.innerHTML='Gata! Ți-am trimis meniul pe email.';
      if(j.downloadUrl){
        const a=document.createElement('a'); a.href=j.downloadUrl; a.target='_blank'; a.rel='noopener';
        a.className='btn btn-outline'; a.style.marginLeft='8px'; a.textContent='Descarcă PDF'; statusB.appendChild(a);
      }
      form.reset(); setTimeout(()=> modal.classList.remove('show'), 1600);
    }else{
      const url = await generatePDFClean(formData);
      statusB.innerHTML='Server indisponibil — PDF generat local.';
      const a=document.createElement('a'); a.href=url; a.target='_blank'; a.rel='noopener';
      a.className='btn btn-outline'; a.style.marginLeft='8px'; a.textContent='Descarcă PDF'; statusB.appendChild(a);
    }
  }catch{
    const url = await generatePDFClean(formData);
    statusB.innerHTML='Conexiune eșuată — PDF generat local.';
    const a=document.createElement('a'); a.href=url; a.target='_blank'; a.rel='noopener';
    a.className='btn btn-outline'; a.style.marginLeft='8px'; a.textContent='Descarcă PDF'; statusB.appendChild(a);
  }finally{
    [prevBtn,nextBtn,submit].forEach(b=> b && (b.disabled=false));
    submit.classList.remove('is-loading');
  }
});

/* ================== FONT LOADER (Inter) ================== */
async function ensureInterFonts(doc){
  const toB64 = (buf) => {
    const u = new Uint8Array(buf), chunk = 0x8000;
    let b = ''; for (let i=0;i<u.length;i+=chunk) b += String.fromCharCode.apply(null, u.subarray(i,i+chunk));
    return btoa(b);
  };
  try{
    const [reg,bold]=await Promise.all([
      fetch('/fonts/Inter-Regular.ttf',{cache:'force-cache'}).then(r=>r.arrayBuffer()),
      fetch('/fonts/Inter-Bold.ttf',{cache:'force-cache'}).then(r=>r.arrayBuffer())
    ]);
    doc.addFileToVFS('Inter-Regular.ttf', toB64(reg));
    doc.addFileToVFS('Inter-Bold.ttf', toB64(bold));
    doc.addFont('Inter-Regular.ttf','Inter','normal');
    doc.addFont('Inter-Bold.ttf','Inter','bold');
    return true;
  }catch(e){
    console.warn('Inter nu s-a putut încărca. Fallback Helvetica (fără diacritice).', e);
    return false;
  }
}

/* ================ DEMO DATA (integral + gramaje) ================ */
function makePlanDemo(diet, daysArr){
  const keto = (diet||'').toLowerCase().includes('keto');
  const pools = keto ? {
    md: [
      {name:'Omletă cu spanac', integral:false, ing:[['ouă',120],['spanac',60],['ulei măsline',10]]},
      {name:'Brânză cottage + castravete', integral:false, ing:[['brânză cottage',180],['castravete',120]]},
      {name:'Ouă poșate cu avocado', integral:false, ing:[['ouă',120],['avocado',90]]},
    ],
    pranz: [
      {name:'Salată cu somon', integral:false, ing:[['somon',150],['mix verdețuri',120],['avocado',60]]},
      {name:'Supă cremă de dovleac', integral:false, ing:[['dovleac',300],['smântână',30],['semințe dovleac',10]]},
    ],
    cina: [
      {name:'Somon la cuptor + sparanghel', integral:false, ing:[['somon',160],['sparanghel',180],['ulei măsline',10]]},
      {name:'File de cod + broccoli', integral:false, ing:[['cod',170],['broccoli',220],['unt',10]]},
      {name:'Piept pui + legume grill', integral:false, ing:[['piept pui',160],['ardei',120],['dovlecel',150]]},
    ],
    gust: [
      {name:'Nuci + iaurt grecesc', integral:false, ing:[['iaurt grecesc',150],['mix nuci',25]]},
      {name:'Iaurt + zmeură', integral:false, ing:[['iaurt',180],['zmeură',80]]},
    ],
  } : {
    md: [
      {name:'Ovăz cu fructe', integral:true, ing:[['ovăz integral',60],['lapte',200],['fructe',100]]},
      {name:'Iaurt cu granola', integral:true, ing:[['iaurt',200],['granola integrală',40],['fructe',80]]},
      {name:'Omletă cu legume', integral:false, ing:[['ouă',120],['ardei',60],['ciuperci',60]]},
    ],
    pranz: [
      {name:'Paste integrale cu pui', integral:true, ing:[['paste integrale',70],['piept pui',150],['roșii',120]]},
      {name:'Salată grecească', integral:false, ing:[['brânză feta',80],['roșii',120],['măsline',30]]},
      {name:'Orez brun cu legume + tofu', integral:true, ing:[['orez brun',70],['tofu',140],['legume',200]]},
      {name:'Supă de roșii + crutoane integrale', integral:true, ing:[['roșii',350],['pâine integrală',40]]},
    ],
    cina: [
      {name:'Vită la tigaie + salată', integral:false, ing:[['vită',180],['salată',140]]},
      {name:'Pește la grătar + quinoa', integral:true, ing:[['pește',160],['quinoa',60],['legume',180]]},
      {name:'Curry de năut + orez brun', integral:true, ing:[['năut',160],['orez brun',60],['sos curry',120]]},
    ],
    gust: [
      {name:'Banana + migdale', integral:false, ing:[['banană',120],['migdale',20]]},
      {name:'Crackers integrali cu hummus', integral:true, ing:[['crackers integrali',30],['hummus',70]]},
      {name:'Brânză + biscuiți integrali', integral:true, ing:[['brânză',40],['biscuiți integrali',30]]},
    ],
  };

  const pick = (a)=> a[Math.floor(Math.random()*a.length)];
  const kcal = (p,c,f)=> Math.round(p*4 + c*4 + f*9);

  return daysArr.map(d=>{
    const raw = [
      {meal:'Mic dejun', item: pick(pools.md),   p:28, c:keto?8:30,  f:keto?20:10, g:300},
      {meal:'Prânz',     item: pick(pools.pranz),p:35, c:keto?18:45, f:keto?16:12, g:420},
      {meal:'Cină',      item: pick(pools.cina), p:32, c:keto?12:35, f:keto?18:14, g:380},
      {meal:'Gustare',   item: pick(pools.gust), p:10, c:keto?8:20,  f:keto?12:8,  g:120},
    ];

    const meals = raw.map(x=>{
      const ingredientsTxt = x.item.ing.map(([n,g])=>`${n} ${g}g`).join(' • ');
      const dishWithGrams = `${x.item.name} (${ingredientsTxt})`;
      return {
        meal: x.meal,
        dish: dishWithGrams,
        integral: !!x.item.integral,
        g: x.g, p: x.p, c: x.c, f: x.f,
        kcal: kcal(x.p,x.c,x.f),
      };
    });

    return { d, meals };
  });
}

/* ================= PDF generator ================= */
async function generatePDFClean(form){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit:'pt', format:'a4' });

  // Font & culori
  const hasInter = await ensureInterFonts(doc);
  const FONT = hasInter ? 'Inter' : 'helvetica';
  const W = doc.internal.pageSize.getWidth();
  const H = doc.internal.pageSize.getHeight();
  const M = 42;
  const GREEN=[14,90,67], GOLD=[201,162,39], TEXT=[27,39,35], MUTED=[109,118,122];

  doc.setFont(FONT,'normal');

  // Header
  doc.setFillColor(...GREEN); doc.rect(0,0,W,88,'F');
  doc.setTextColor(255,255,255); doc.setFont(FONT,'bold'); doc.setFontSize(22);
  doc.text('Meniu personalizat', M, 52);
  doc.setDrawColor(...GOLD); doc.setLineWidth(2); doc.line(M,88,W-M,88);

  // Perioadă
  const luni=['ian','feb','mar','apr','mai','iun','iul','aug','sep','oct','nov','dec'];
  const start=new Date();
  const days=[...Array(7)].map((_,i)=> new Date(start.getFullYear(),start.getMonth(),start.getDate()+i));
  doc.setFont(FONT,'normal'); doc.setFontSize(11); doc.setTextColor(220,240,233);
  doc.text(`Perioadă: ${days[0].getDate()} ${luni[days[0].getMonth()]} – ${days[6].getDate()} ${luni[days[6].getMonth()]}`, W-M, 52, {align:'right'});

  // Profil
  let y=116;
  doc.setTextColor(...TEXT); doc.setFont(FONT,'bold'); doc.setFontSize(13);
  doc.text('Profil client', M, y); y+=16;
  doc.setFont(FONT,'normal'); doc.setFontSize(11); doc.setTextColor(...MUTED);
  const left = [`Nume: ${form.nume||'-'}`, `Email: ${form.email||'-'}`, `Oraș: ${form.oras||'-'}`];
  const right = [`Obiectiv: ${form.obiectiv||'-'}`, `Dietă: ${form.dieta||'Fără restricții'}`, `Alergii: ${form.alergii||'-'}`];
  left.forEach((s,i)=> doc.text(s, M, y + i*16));
  right.forEach((s,i)=> doc.text(s, W/2, y + i*16));
  y += 16*3 + 10; doc.setDrawColor(230,236,232); doc.line(M,y,W-M,y); y += 22;

  // Plan + tabel
  const plan = makePlanDemo(form.dieta, days);
  const body = [];
  plan.forEach(day=>{
    const zi = `${day.d.getDate()} ${luni[day.d.getMonth()]}`;
    let tot={g:0,kcal:0,p:0,c:0,f:0};
    day.meals.forEach((m,idx)=>{
      body.push([ idx===0?zi:'', m.meal, m.dish, m.integral?'✓':'', m.g, m.kcal, m.p, m.c, m.f ]);
      tot.g+=m.g; tot.kcal+=m.kcal; tot.p+=m.p; tot.c+=m.c; tot.f+=m.f;
    });
    body.push([ {content:'TOTAL ZI', colSpan:4, styles:{fontStyle:'bold'}}, tot.g, tot.kcal, tot.p, tot.c, tot.f ]);
  });

  doc.setFont(FONT,'bold'); doc.setFontSize(13); doc.setTextColor(...TEXT);
  doc.text('Meniu pe 7 zile (porție & macro/masă)', M, y); y += 8;

  doc.autoTable({
    startY: y+10,
    head: [['Ziua','Masă','Preparat','Int','g/porț.','kcal','P','C','F']],
    body,
    theme: 'grid',
    styles: { font: FONT, fontSize:10, cellPadding:6, textColor:[27,39,35], lineColor:[230,236,232], lineWidth:0.6 },
    headStyles: { font: FONT, fillColor:[246,251,248], textColor:[20,30,26], fontStyle:'bold' },
    alternateRowStyles: { fillColor:[252,254,253] },
    columnStyles: {
      0:{cellWidth:56}, 1:{cellWidth:78}, 2:{cellWidth:250},
      3:{cellWidth:28, halign:'center'},
      4:{cellWidth:52, halign:'right'}, 5:{cellWidth:54, halign:'right'},
      6:{cellWidth:44, halign:'right'}, 7:{cellWidth:44, halign:'right'}, 8:{cellWidth:44, halign:'right'}
    },
    margin: { left: M, right: M },
    didParseCell(data){
      const cell0 = data.row?.raw?.[0];
      if (cell0 && cell0.content === 'TOTAL ZI'){
        data.cell.styles.fillColor = [240,244,242];
        data.cell.styles.fontStyle = 'bold';
      }
    },
    didDrawPage(data){
      const pageStr = `BP · AI Nutriție — Pag. ${data.pageNumber}`;
      doc.setFont(FONT,'normal'); doc.setFontSize(9.5); doc.setTextColor(109,118,122);
      doc.text(pageStr, W - M, H - 18, { align:'right' });
    }
  });

  const blob = doc.output('blob');
  return URL.createObjectURL(blob);
}
</script>
</body>
</html>

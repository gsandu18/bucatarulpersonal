<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard Bucătari – Profesional</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous"/>
  <style>
    :root{ --verde:#0e5a43; --verde-2:#0b4a36; --text:#1c2226; --g1:#f6fbf8; --g2:#eef3ff; --b1:#fff; --b2:#e8ecee; --b3:#cfd6da; --warn:#fff3cd; --warn-text:#856404; --shadow:0 14px 46px rgba(0,0,0,.12); }
    *{box-sizing:border-box}
    html,body{margin:0}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--text);
      background:radial-gradient(1200px 600px at -10% -10%,var(--g2),#fff 40%),radial-gradient(900px 500px at 110% -20%,var(--g1),#fff 40%);
      min-height:100vh;}
    .container{width:min(1180px,94%);margin:auto;padding-bottom:48px}
    /* Tabs */
    .tabs{position:sticky;top:0;background:#ffffffc9;border-bottom:1px solid var(--b2);backdrop-filter:saturate(140%) blur(6px);
      z-index:10;display:flex;gap:10px;padding:12px 0;flex-wrap:wrap}
    .tab{padding:10px 14px;border:1px solid var(--b3);border-radius:999px;font-weight:700;background:#fff;cursor:pointer;user-select:none}
    .tab.active{border-color:var(--verde);color:var(--verde);box-shadow:0 6px 18px rgba(14,90,67,.18)}
    /* Cards */
    .card{background:#fff;border:1px solid var(--b2);border-radius:18px;padding:20px;box-shadow:var(--shadow);margin-top:18px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    @media(max-width:900px){.grid{grid-template-columns:1fr}}
    label{font-size:14px;font-weight:700;display:block;margin-bottom:6px}
    input,textarea,select{width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--b3);background:#fbfcfc}
    textarea{min-height:90px}
    .note{font-size:13px;color:#5c6a6f}
    .warn{background:var(--warn);color:var(--warn-text);padding:10px 12px;border-radius:10px;font-weight:700;display:flex;gap:8px;align-items:center;margin:10px 0}
    /* Chat */
    .req-layout{display:grid;grid-template-columns:0.42fr 1fr;gap:16px}
    @media(max-width:900px){.req-layout{grid-template-columns:1fr}}
    .req-list{border:1px solid var(--b2);border-radius:12px;overflow:hidden;background:#fff}
    .req-item{padding:12px;border-bottom:1px solid var(--b2);cursor:pointer;display:flex;justify-content:space-between}
    .req-item.active{background:#f6fbf8;border-left:4px solid var(--verde)}
    .badge{font-size:12px;padding:4px 8px;border-radius:999px}
    .badge.pending{background:#fff7e6;color:#8a5b00}
    .badge.accepted{background:#eaf5ef;color:var(--verde-2)}
    .badge.closed{background:#eceff3;color:#555}
    .chat{border:1px solid var(--b2);border-radius:14px;display:flex;flex-direction:column;height:420px;background:#fff}
    .chat-messages{flex:1;overflow:auto;padding:12px;display:flex;flex-direction:column;gap:10px;background:#fafdfb}
    .msg{max-width:75%;padding:10px 12px;border-radius:12px}
    .msg.me{align-self:flex-end;background:var(--verde);color:#fff}
    .msg.them{align-self:flex-start;background:#eef5f1}
    .chat-input{display:flex;gap:8px;padding:10px;border-top:1px solid var(--b2)}
    .chat-input input{flex:1}
    /* Tables */
    .table{width:100%;border-collapse:separate;border-spacing:0 8px}
    .table th{background:var(--verde);color:#fff;text-align:left;padding:10px;border-radius:8px}
    .table td{background:#f6fbf8;padding:8px;border:1px solid #d1ded6}
    /* Financiar */
    .wallet{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px}
    .stat{border:1px solid var(--b2);border-radius:14px;padding:16px;background:linear-gradient(135deg,#f2faf5,#fff)}
    .stat strong{font-size:20px}
    /* Profile portrait */
    .portrait{display:flex;gap:16px;align-items:flex-start;flex-wrap:wrap}
    .portrait img{width:300px;height:300px;object-fit:cover;border-radius:10px;border:3px solid var(--verde);background:#ddd}
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);color:#fff;display:none;align-items:center;justify-content:center;text-align:center;padding:20px;font-size:18px;z-index:999}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:999px;border:1px solid var(--b3);background:#fff;font-weight:700;cursor:pointer}
    .btn.primary{background:var(--verde);border-color:transparent;color:#fff}
    /* Progress */
    .progress-card{display:flex;flex-direction:column;gap:8px}
    .progress-rail{height:12px;background:#eef3ef;border-radius:999px;overflow:hidden}
    .progress-bar{height:100%;width:0;background:linear-gradient(90deg,var(--verde),#23a576);transition:width .35s ease;border-radius:999px}
    .progress-head{display:flex;justify-content:space-between;align-items:center}
    /* Documente (colaborare) */
    .collab-note{background:#fff3cd;padding:12px;border-radius:8px;font-size:14px;margin-bottom:16px}
    .collab-options{display:flex;gap:20px;margin-bottom:20px;flex-wrap:wrap}
    .collab-option{flex:1;min-width:260px;border:2px solid #ddd;border-radius:10px;padding:16px;cursor:pointer;transition:all .3s;background:#fff}
    .collab-option:hover{border-color:var(--verde);background:#f9fffb}
    .collab-option.active{border-color:var(--verde);background:#e6f4ef}
    .collab-option h3{margin-top:0;font-size:16px;color:var(--verde)}
    .calc{border-top:1px solid #eee;padding-top:16px;margin-top:6px}
    .row{display:flex;gap:16px;margin-bottom:10px;align-items:center}
    .row label{flex:1}
    .row input,.row select{flex:2;padding:8px;border:1px solid #ccc;border-radius:8px}
    .result{margin-top:8px;font-weight:600;font-size:15px}
    .btn-save{padding:10px 16px;border-radius:8px;border:1px solid var(--verde);background:var(--verde);color:#fff;font-weight:600}
    .btn-outline{padding:10px 16px;border-radius:8px;border:1px solid var(--verde);background:#fff;color:var(--verde);font-weight:600}
    .docs-list{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px;margin-top:10px}
    .doc-card{border:1px solid #e0e6e8;border-radius:10px;padding:10px;background:#fbfcfc;display:flex;gap:10px;align-items:flex-start}
    .doc-card i{font-size:18px;margin-top:2px;color:var(--verde)}
    .doc-meta{font-size:13px;color:#48525a}
    .doc-actions{margin-left:auto}
    .doc-actions button{border:0;background:transparent;cursor:pointer;color:#b23;}
    .doc-kind{font-size:12px;padding:2px 6px;border-radius:999px;background:#eef5f1;color:var(--verde-2);margin-left:6px}
    /* Toggle switch for meniuri zilnice */
    .switch{position:relative;display:inline-block;width:56px;height:30px}
    .switch input{opacity:0;width:0;height:0}
    .slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:#cfd6da;transition:.2s;border-radius:999px}
    .slider:before{position:absolute;content:"";height:24px;width:24px;left:3px;top:3px;background:#fff;transition:.2s;border-radius:50%}
    .switch input:checked + .slider{background:var(--verde)}
    .switch input:checked + .slider:before{transform:translateX(26px)}
    .counter{font-size:12px;color:#768287;margin-top:4px;text-align:right}
  </style>
</head>
<body>
<div class="container">
  <nav class="tabs" id="tabs">
    <span class="tab active" data-tab="profil">Profil</span>
    <span class="tab" data-tab="documente">Documente</span>
    <span class="tab" data-tab="galerie">Galerie</span>
    <span class="tab" data-tab="meniuri">Meniuri</span>
    <span class="tab" data-tab="cereri">Cereri</span>
    <span class="tab" data-tab="financiar">Financiar</span>
  </nav>

  <section class="card progress-card" id="progress">
    <div class="progress-head">
      <strong>Progres profil</strong>
      <span id="progress-label">0%</span>
    </div>
    <div class="progress-rail"><div id="progress-bar" class="progress-bar"></div></div>
    <div id="progress-tips" class="note">Completează pașii pentru activare completă.</div>
  </section>

  <section class="card section" id="profil">
    <h2>Profil – Portret obligatoriu</h2>
    <div class="warn"><i class="fa-solid fa-triangle-exclamation"></i> Poza trebuie să fie pătrată (min. 600×600px), <b>în tunica oficială Bucătarul Personal</b>. Se aplică automat un watermark transparent.</div>
    <div class="portrait">
      <img id="portraitPreview" src="https://via.placeholder.com/300x300.png?text=Portret" alt="Portret"/>
      <div>
        <div id="quality" class="note"></div>
        <input type="file" id="portraitUpload" accept="image/jpeg,image/png"/>
        <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
          <button id="cameraBtn" class="btn primary"><i class="fa-solid fa-camera"></i> Fă poză</button>
          <button id="removePortrait" class="btn"><i class="fa-solid fa-trash"></i> Șterge</button>
        </div>
        <div class="note" style="margin-top:10px">Opțional: încarcă <b>logo PNG</b> pentru watermark. <input type="file" id="wmUpload" accept="image/png"></div>
      </div>
    </div>

    <hr style="margin:18px 0;border:0;border-top:1px solid var(--b2)">
    <h3 style="margin-top:0">Date de profil</h3>
    <p class="note">Aceste informații apar pe profilul tău public (cu excepția parolei). Completează-le pentru a crește șansele de rezervare.</p>
    <div class="grid">
      <div>
        <label for="pf-nume">Nume</label>
        <input id="pf-nume" placeholder="Ex.: Ionescu" />
      </div>
      <div>
        <label for="pf-prenume">Prenume</label>
        <input id="pf-prenume" placeholder="Ex.: Andrei" />
      </div>
      <div>
        <label for="pf-email">E-mail</label>
        <input id="pf-email" type="email" placeholder="exemplu@domeniu.com" />
      </div>
      <div>
        <label for="pf-parola">Parolă</label>
        <input id="pf-parola" type="password" placeholder="Minim 8 caractere" />
        <div class="note">Parola nu se stochează în localStorage în acest demo.</div>
      </div>
      <div>
        <label for="pf-capacitate">Capacitate maximă eveniment</label>
        <input id="pf-capacitate" type="number" min="1" step="1" placeholder="Ex.: 50" />
        <div class="note">Numărul maxim de persoane pe care le poți gestiona într-un eveniment.</div>
      </div>
      <div>
        <label>Meniuri zilnice acasă</label>
        <div style="display:flex;align-items:center;gap:10px">
          <label class="switch"><input id="pf-daily" type="checkbox"><span class="slider"></span></label>
          <span class="note" id="pf-daily-label">Nu accept</span>
        </div>
      </div>
    </div>

    <div class="grid" style="margin-top:8px">
      <div>
        <label for="pf-experienta-ani">Experiență (ani)</label>
        <input id="pf-experienta-ani" type="number" min="0" step="1" placeholder="Ex.: 5" />
      </div>
      <div>
        <label for="pf-experienta">Experiență & specializări (text, opțional)</label>
        <textarea id="pf-experienta" placeholder="Ex.: bucătărie mediteraneană, grill, plating artistic, HACCP..."></textarea>
        <div class="counter" id="ctr-exp">0 caractere</div>
      </div>
    </div>

    <div style="margin-top:8px">
      <label for="pf-descriere">Prezentare pentru clienți (vizibilă public) – cum îți prezinți serviciile</label>
      <textarea id="pf-descriere" placeholder="Scrie o descriere convingătoare (minim 30 caractere): experiență, stil, ce te diferențiază, zone acoperite, tipuri de evenimente."></textarea>
      <div class="counter" id="ctr-desc">0 caractere</div>
    </div>

    <div style="margin-top:12px;display:flex;gap:10px;align-items:center">
      <button id="pf-save" class="btn primary"><i class="fa-solid fa-floppy-disk"></i> Salvează profil</button>
      <div id="pf-msg" class="note"></div>
    </div>
  </section>

  <section class="card section collab-wrap" id="documente" style="display:none">
    <h2>Modalități de colaborare</h2>
    <div class="collab-note">Alege varianta de colaborare cu platforma. Calculul este orientativ.</div>
    <div class="collab-options">
      <div class="collab-option" id="opt-firma">
        <h3>Varianta 1 – Cu firmă (PFA/SRL)</h3>
        <ul>
          <li>Bucătarul emite factură către Platformă.</li>
          <li>Plata se face integral conform onorariului agreat, <b>minus comisionul</b> de platformă.</li>
        </ul>
      </div>
      <div class="collab-option" id="opt-fara">
        <h3>Varianta 2 – Fără firmă</h3>
        <ul>
          <li>Plata prin <b>contract de colaborare</b> (persoană fizică).</li>
          <li>Onorariul net este diminuat cu <b>taxele legale</b>, suportate de Platformă.</li>
          <li>Se aplică același comision de platformă.</li>
        </ul>
      </div>
    </div>

    <div class="calc">
      <h3>Calculator orientativ de încasare</h3>
      <div class="row"><label for="onorariu">Onorariu bucătar (brut)</label><input type="number" id="onorariu" value="1500" /></div>
      <div class="row"><label for="comision">Comision platformă (%)</label><input type="number" id="comision" value="20" /></div>
      <div class="row" id="row-taxe"><label for="taxe">Taxe legale (%)</label><input type="number" id="taxe" value="0" /></div>
      <div class="row" id="row-categorie" style="display:none"><label for="categorie">Categorie firmă</label>
        <select id="categorie"><option value="">Alege...</option><option value="PFA">PFA</option><option value="SRL">SRL</option></select>
      </div>
      <div class="result" id="rezultat">Net estimat: 1.200 lei</div>
    </div>

    <div class="calc" id="formular-colaborare">
      <h3>Formular de colaborare</h3>
      <div class="note">Completează datele corespunzătoare variantei alese. Contractul se va genera automat cu aceste date.</div>
      <div id="form-firma" style="display:none">
        <div class="row"><label for="firma-denumire">Denumire firmă / Nume titular</label><input id="firma-denumire"/></div>
        <div class="row"><label for="firma-cui">CUI / CIF (PFA: CNP)</label><input id="firma-cui"/></div>
        <div class="row"><label for="firma-reg">Nr. Reg. Com. / Nr. autorizație</label><input id="firma-reg"/></div>
        <div class="row"><label for="firma-sediu">Sediu social / Domiciliu</label><input id="firma-sediu"/></div>
        <div class="row"><label for="firma-repr">Reprezentant (SRL) / Titular (PFA)</label><input id="firma-repr"/></div>
        <div class="row"><label for="firma-email">Email</label><input id="firma-email" type="email"/></div>
        <div class="row"><label for="firma-tel">Telefon</label><input id="firma-tel"/></div>
        <div class="row"><label for="firma-iban">IBAN</label><input id="firma-iban"/></div>
        <div class="row"><label for="firma-banca">Banca</label><input id="firma-banca"/></div>
      </div>
      <div id="form-pf" style="display:none">
        <div class="row"><label for="pf-nume2">Nume complet</label><input id="pf-nume2"/></div>
        <div class="row"><label for="pf-cnp">CNP</label><input id="pf-cnp"/></div>
        <div class="row"><label for="pf-adresa">Adresă</label><input id="pf-adresa"/></div>
        <div class="row"><label for="pf-email2">Email</label><input id="pf-email2" type="email"/></div>
        <div class="row"><label for="pf-tel">Telefon</label><input id="pf-tel"/></div>
        <div class="row"><label for="pf-iban">IBAN (opțional)</label><input id="pf-iban"/></div>
        <div class="row"><label for="pf-banca">Banca (opțional)</label><input id="pf-banca"/></div>
      </div>
      <div class="row" style="justify-content:flex-start; gap:12px">
        <button class="btn-save" id="form-save" type="button">Salvează formular</button>
        <button class="btn-outline" id="form-gen" type="button">Generează contract</button>
        <span id="form-msg" class="result" style="font-weight:500"></span>
      </div>
    </div>

    <div class="calc" id="docs-colab">
      <h3>Documente necesare</h3>
      <div class="note" id="docs-req">Încarcă: CI (față/verso) + Diplomă/Certificat bucătar (PDF/JPG/PNG). Extras de cont – opțional. Max 5MB/fișier. Min. 1 fișier.</div>
      <div style="display:flex; gap:10px; align-items:center; margin:6px 0">
        <label for="docs-kind" class="note" style="font-weight:600">Tip document</label>
        <select id="docs-kind"><option value="CI">CI (față/verso)</option><option value="DIPLOMA">Diplomă/Certificat bucătar</option><option value="EXTRAS">Extras de cont (opțional)</option></select>
      </div>
      <input type="file" id="docs-input" multiple accept="application/pdf,image/*">
      <div id="docs-list" class="docs-list"></div>
    </div>
  </section>

  <section class="card section" id="galerie" style="display:none">        
    <h2>Galerie (maxim 6 poze)</h2>
    <div class="warn"><i class="fa-solid fa-triangle-exclamation"></i> Pozele trebuie să fie <b>reale</b>, nu copiate. (max 2MB/poză)</div>
    <input type="file" id="gal-upload" accept="image/*" multiple>
    <div id="gal-wrap" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px;margin-top:10px"></div>
    <div class="note" id="gal-note"></div>
  </section>

  <section class="card section" id="meniuri" style="display:none">
    <h2>Meniuri & calcule</h2>
    <p class="note">preț bucătar = persoane × preparate × tarif → total client = preț bucătar × (1 + comision/100)</p>
    <div class="grid">
      <div class="card">
        <h3><i class="fa-solid fa-bowl-food"></i> Tradițional</h3>
        <table class="table"><thead><tr><th>Nr. persoane</th><th>Nr. preparate</th><th>Tarif</th><th>Comision (%)</th><th>Preț bucătar</th><th>Total client</th></tr></thead>
          <tbody><tr>
            <td><input type="number" id="fam-pers" value="10"></td>
            <td><input type="number" id="fam-prep" value="5"></td>
            <td><input type="number" id="fam-tarif" value="35"></td>
            <td><input type="number" id="fam-comm" value="20"></td>
            <td><input type="text" id="fam-chef" readonly></td>
            <td><input type="text" id="fam-total" readonly></td>
          </tr></tbody>
        </table>
      </div>
      <div class="card">
        <h3><i class="fa-solid fa-champagne-glasses"></i> Fine Dining</h3>
        <table class="table"><thead><tr><th>Nr. persoane</th><th>Nr. preparate</th><th>Tarif</th><th>Comision (%)</th><th>Preț bucătar</th><th>Total client</th></tr></thead>
          <tbody><tr>
            <td><input type="number" id="priv-pers" value="6"></td>
            <td><input type="number" id="priv-prep" value="4"></td>
            <td><input type="number" id="priv-tarif" value="60"></td>
            <td><input type="number" id="priv-comm" value="20"></td>
            <td><input type="text" id="priv-chef" readonly></td>
            <td><input type="text" id="priv-total" readonly></td>
          </tr></tbody>
        </table>
      </div>
      <div class="card">
        <h3><i class="fa-solid fa-crown"></i> Premium</h3>
        <table class="table"><thead><tr><th>Nr. persoane</th><th>Nr. preparate</th><th>Tarif</th><th>Comision (%)</th><th>Preț bucătar</th><th>Total client</th></tr></thead>
          <tbody><tr>
            <td><input type="number" id="corp-pers" value="20"></td>
            <td><input type="number" id="corp-prep" value="6"></td>
            <td><input type="number" id="corp-tarif" value="45"></td>
            <td><input type="number" id="corp-comm" value="15"></td>
            <td><input type="text" id="corp-chef" readonly></td>
            <td><input type="text" id="corp-total" readonly></td>
          </tr></tbody>
        </table>
      </div>
    </div>
  </section>

  <section class="card section" id="cereri" style="display:none">
    <h2>Cererile mele</h2>
    <div class="req-layout">
      <aside class="req-list" id="req-list"></aside>
      <div class="chat">
        <div class="chat-messages" id="chat"></div>
        <div class="chat-input"><input id="chat-input" placeholder="Scrie un mesaj..."><button id="chat-send" class="btn primary"><i class="fa-solid fa-paper-plane"></i> Trimite</button></div>
      </div>
    </div>
  </section>

  <section class="card section" id="financiar" style="display:none">
    <h2>Financiar</h2>
    <div class="wallet">
      <div class="stat"><div class="note">Credit disponibil</div><strong id="credit">5 000 lei</strong></div>
      <div class="stat"><div class="note">Sold curent</div><strong id="sold">0 lei</strong></div>
      <div class="stat"><div class="note">Plăți recente</div><div id="payments" class="note">—</div></div>
    </div>
    <div class="card" style="margin-top:12px">
      <h3 style="margin:0 0 8px">Cont bancar</h3>
      <div class="grid">
        <div><label for="bank-name">Nume bancă</label><input id="bank-name" placeholder="BCR / BT / ING"></div>
        <div><label for="bank-iban">IBAN</label><input id="bank-iban" placeholder="ROxx BANK xxxx xxxx xxxx xxxx"></div>
      </div>
      <div style="margin-top:10px;display:flex;gap:10px;align-items:center">
        <button id="bank-save" class="btn primary"><i class="fa-solid fa-floppy-disk"></i> Salvează</button>
        <div id="bank-msg" class="note"></div>
      </div>
    </div>
  </section>
</div>

<div id="overlay" class="overlay">⚠️ Trebuie să încarci o poză de portret validă pentru a continua în dashboard.</div>

<script>
document.addEventListener('DOMContentLoaded', ()=> {
  // === Helpers ===
  const Store = localStorage;
  const getJSON = (k,d)=>{ try{const v=Store.getItem(k); return v?JSON.parse(v):d}catch(_){return d} };
  const setJSON = (k,v)=>{ try{ Store.setItem(k, JSON.stringify(v)) }catch(_){ } };
  const nf = new Intl.NumberFormat('ro-RO');
  const fmt = n => nf.format(Math.round(+n||0));
  const fmtRON = n => fmt(n) + ' lei';
  const $ = sel => document.querySelector(sel);
  const byId = id => document.getElementById(id);

  // === UI refs (există în pagină) ===
  const tabs = byId('tabs');
  const overlay = byId('overlay');
  const sections = { profil:'profil', documente:'documente', galerie:'galerie', cereri:'cereri', financiar:'financiar' };
  const pb = byId('progress-bar'), pl = byId('progress-label'), pt = byId('progress-tips');

  // === Validatori ===
  const isValidEmail = e => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e||'');
  function isValidRomanianIBAN(ibanRaw){
    const iban=(ibanRaw||'').replace(/\s+/g,'').toUpperCase();
    if(!/^RO[0-9A-Z]{22}$/.test(iban)) return false;
    const rearr=iban.slice(4)+iban.slice(0,4);
    const expanded=rearr.replace(/[A-Z]/g,ch=>(ch.charCodeAt(0)-55).toString());
    let r=0; for(let i=0;i<expanded.length;i+=7){ const part=(''+r)+expanded.substring(i,i+7); r=parseInt(part,10)%97; }
    return r===1;
  }

  // === Tabs ===
  function show(id){
    Object.values(sections).forEach(s => { const el=byId(s); if(el) el.style.display='none'; });
    const ok = byId(id);
    if(ok) ok.style.display = 'block';
  }
  tabs.addEventListener('click', e=>{
    const t = e.target.closest('.tab'); if(!t) return;
    const tab = t.dataset.tab;
    // Overlay NU blochează "documente"
    const hasPortrait = !!Store.getItem('PORTRAIT');
    if(!hasPortrait && !['profil','documente'].includes(tab)){
      overlay.style.display='flex';
      return;
    }
    tabs.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
    t.classList.add('active');
    show(sections[tab]);
    if(['profil','documente'].includes(tab)) overlay.style.display='none';
    computeProgress(); // recalc la fiecare switch
  });
  overlay.addEventListener('click', ()=> overlay.style.display='none');

  // === Portret (simplu) ===
  const portraitPreview = byId('portraitPreview');
  const portraitUpload  = byId('portraitUpload');
  const removePortrait  = byId('removePortrait');
  const qualityEl       = byId('quality');
  const wmUpload        = byId('wmUpload');
  let wmLogoData = getJSON('WM_LOGO', null);

  wmUpload?.addEventListener('change',()=>{
    const f=wmUpload.files?.[0]; if(!f) return;
    const r=new FileReader(); r.onload=e=>{ wmLogoData=e.target.result; Store.setItem('WM_LOGO', wmLogoData); alert('Logo watermark salvat.'); };
    r.readAsDataURL(f);
  });

  function checkQuality(w,h){
    if(!qualityEl) return true;
    if(w<600||h<600){ qualityEl.textContent='Calitate: Slabă (minim 600×600px)'; qualityEl.style.color='#dc3545'; return false; }
    const ratio=w/h;
    if(ratio<0.8||ratio>1.2){ qualityEl.textContent='Calitate: Acceptabilă (nu e pătrată)'; qualityEl.style.color='#e69500'; return true; }
    qualityEl.textContent='Calitate: Bună'; qualityEl.style.color='#198754'; return true;
  }
  function cropToSquare(img){
    const size=Math.min(img.width,img.height), sx=(img.width-size)/2, sy=(img.height-size)/2;
    const c=document.createElement('canvas'); c.width=c.height=size; c.getContext('2d').drawImage(img,sx,sy,size,size,0,0,size,size); return c;
  }
  function drawWatermark(canvas){
    const ctx=canvas.getContext('2d');
    ctx.save(); ctx.globalAlpha=0.22; ctx.translate(canvas.width/2, canvas.height/2); ctx.rotate(-Math.PI/6);
    ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillStyle='#0e5a43'; ctx.font=Math.round(canvas.width*0.08)+'px Inter, Arial';
    ctx.fillText('BUCĂTARUL PERSONAL', 0, 0); ctx.restore();
    if(wmLogoData){ const img=new Image(); img.onload=()=>{ const w=Math.min(canvas.width*0.28, img.width); const h=w*(img.height/img.width); const c2=canvas.getContext('2d'); c2.save(); c2.globalAlpha=0.35; c2.drawImage(img, canvas.width-w-14, canvas.height-h-14, w, h); c2.restore(); }; img.src=wmLogoData; }
  }
  function processPortrait(dataURL){
    const img=new Image();
    img.onload=()=>{
      const validBase=checkQuality(img.naturalWidth,img.naturalHeight);
      const squareCanvas=cropToSquare(img);
      const out=document.createElement('canvas'); out.width=out.height=900;
      out.getContext('2d').drawImage(squareCanvas,0,0,900,900);
      drawWatermark(out);
      const finalData=out.toDataURL('image/png');
      if(portraitPreview) portraitPreview.src=finalData;
      Store.setItem('PORTRAIT', finalData);
      overlay.style.display = validBase ? 'none' : 'flex';
      computeProgress();
    };
    img.src=dataURL;
  }
  portraitUpload?.addEventListener('change',()=>{
    const f=portraitUpload.files?.[0]; if(!f) return;
    if(!/image\/(png|jpeg)/.test(f.type)){ alert('Acceptăm doar JPG/PNG'); return; }
    const r=new FileReader(); r.onload=e=>processPortrait(e.target.result); r.readAsDataURL(f);
  });
  removePortrait?.addEventListener('click',()=>{
    Store.removeItem('PORTRAIT');
    if(portraitPreview) portraitPreview.src='https://via.placeholder.com/300x300.png?text=Portret';
    overlay.style.display='flex';
    if(qualityEl){ qualityEl.textContent=''; }
    computeProgress();
  });
  const savedPortrait=Store.getItem('PORTRAIT');
  if(savedPortrait && portraitPreview){ portraitPreview.src=savedPortrait; overlay.style.display='none'; if(qualityEl){ qualityEl.textContent='Calitate: Bună'; qualityEl.style.color='#198754'; } }

  // === Profil (scurt) ===
  const PF = {
    nume: byId('pf-nume'),
    prenume: byId('pf-prenume'),
    email: byId('pf-email'),
    parola: byId('pf-parola'),
    capacitate: byId('pf-capacitate'),
    daily: byId('pf-daily'),
    dailyLabel: byId('pf-daily-label'),
    expAni: byId('pf-experienta-ani'),
    expTxt: byId('pf-experienta'),
    desc: byId('pf-descriere'),
    msg: byId('pf-msg'),
    btn: byId('pf-save'),
    ctrExp: byId('ctr-exp'),
    ctrDesc: byId('ctr-desc')
  };
  function updateCounters(){
    if(PF.ctrExp) PF.ctrExp.textContent=(PF.expTxt?.value||'').length+' caractere';
    if(PF.ctrDesc) PF.ctrDesc.textContent=(PF.desc?.value||'').length+' caractere';
  }
  function loadProfile(){
    const d=getJSON('PROFILE_DATA',{});
    if(PF.nume) PF.nume.value=d.nume||'';
    if(PF.prenume) PF.prenume.value=d.prenume||'';
    if(PF.email) PF.email.value=d.email||'';
    if(PF.capacitate) PF.capacitate.value=d.capacitate||'';
    if(PF.daily){ PF.daily.checked=!!d.daily; if(PF.dailyLabel) PF.dailyLabel.textContent=d.daily?'Accept':'Nu accept'; }
    if(PF.expAni) PF.expAni.value=d.expAni||'';
    if(PF.expTxt) PF.expTxt.value=d.expTxt||'';
    if(PF.desc) PF.desc.value=d.descriere||'';
    updateCounters();
  }
  function readProfileFromUI(){ return {
    nume: PF.nume?.value||'', prenume:PF.prenume?.value||'',
    email: (PF.email?.value||'').trim(), capacitate:+(PF.capacitate?.value||0)||0,
    daily: !!PF.daily?.checked, expAni:+(PF.expAni?.value||0)||0,
    expTxt: PF.expTxt?.value||'', descriere: PF.desc?.value||''
  };}
  PF.btn?.addEventListener('click', ()=>{
    const data=readProfileFromUI(); setJSON('PROFILE_DATA', data);
    if(PF.msg){ PF.msg.textContent='Profil salvat.'; setTimeout(()=>PF.msg.textContent='', 2500); }
    computeProgress();
  });
  ['input','change'].forEach(ev=>{
    [PF.nume,PF.prenume,PF.email,PF.capacitate,PF.expAni,PF.expTxt,PF.desc].forEach(el=>{
      el?.addEventListener(ev, ()=>{ updateCounters(); computeProgress(); });
    });
  });
  PF.daily?.addEventListener('change',()=>{ if(PF.dailyLabel) PF.dailyLabel.textContent=PF.daily.checked?'Accept':'Nu accept'; computeProgress(); });
  PF.parola?.addEventListener('change',()=>{
    if(PF.msg){ PF.msg.textContent = (PF.parola.value||'').length<8 ? 'Parola trebuie să aibă minim 8 caractere.' : 'Parola setată (nesalvată local în acest demo).'; setTimeout(()=>PF.msg.textContent='', 2500); }
    PF.parola.value='';
  });
  loadProfile();

  // === Documente / Colaborare ===
  const optFirma = byId('opt-firma'), optFara = byId('opt-fara');
  const rowTaxe = byId('row-taxe'), rowCat = byId('row-categorie'), catSel = byId('categorie');
  const formFirma = byId('form-firma'), formPF = byId('form-pf');
  const docsKind = byId('docs-kind'), docsInput = byId('docs-input'), docsList = byId('docs-list'), docsReq = byId('docs-req');
  const pfPricing = byId('pf-pricing');

  function setType(t){
    Store.setItem('COLAB_TYPE', t);
    optFirma?.classList.toggle('active', t==='firma');
    optFara?.classList.toggle('active', t==='fara');
    if(t==='firma'){
      if(formFirma) formFirma.style.display='block';
      if(formPF) formPF.style.display='none';
      if(rowTaxe) rowTaxe.style.display='none';
      if(rowCat) rowCat.style.display='flex';
      if(pfPricing) pfPricing.style.display='none';
      if(docsReq) docsReq.textContent='Încarcă: Certificat înregistrare (PDF/JPG), CI reprezentant, extras de cont (opțional). Min. 1 fișier.';
    } else {
      if(formFirma) formFirma.style.display='none';
      if(formPF) formPF.style.display='block';
      if(rowTaxe) rowTaxe.style.display='flex';
      if(rowCat) rowCat.style.display='none';
      if(pfPricing) pfPricing.style.display='block';
      if(docsReq) docsReq.innerHTML='Încarcă: <b>CI (față/verso)</b> + <b>Diplomă/Certificat bucătar</b> (ambele obligatorii). Max 5MB/fișier.';
      // scroll fin către tabele când alegi PF
      pfPricing?.scrollIntoView({behavior:'smooth', block:'start'});
    }
    loadForms(); renderDocs(); computeProgress();
  }
  optFirma?.addEventListener('click', ()=> setType('firma'));
  optFara?.addEventListener('click', ()=> setType('fara'));
  // init robust (fără .click() pe element ascuns)
  setType( Store.getItem('COLAB_TYPE') === 'fara' ? 'fara' : 'firma' );

  function currentDocsKey(){ return (Store.getItem('COLAB_TYPE')||'firma')==='fara' ? 'DOCS_PF' : 'DOCS_FIRMA'; }
  function readDocs(){ return getJSON(currentDocsKey(),[]); }
  function writeDocs(a){ setJSON(currentDocsKey(),a); }
  function renderDocs(){
    const a=readDocs();
    const labelKind=k=>k==='DIPLOMA'?'Diplomă/Certificat':(k==='CI'?'CI':(k==='EXTRAS'?'Extras cont':(k||'')));
    if(!docsList) return;
    docsList.innerHTML=a.map((d,i)=>`
      <div class='doc-card'>
        <i class="fa-regular fa-file"></i>
        <div>
          <div><strong>${d.name}</strong> ${d.kind?`<span class='doc-kind'>${labelKind(d.kind)}</span>`:''}</div>
          <div class='doc-meta'>${d.sizeKB||0} KB • ${(d.mime||d.type)||''}</div>
        </div>
        <div class='doc-actions'><button data-i='${i}' class='doc-del' title='Șterge'>&times;</button></div>
      </div>`).join('');
    computeProgress();
  }
  docsList?.addEventListener('click', e=>{
    const b=e.target.closest('.doc-del'); if(!b) return;
    const i=+b.dataset.i; const a=readDocs(); a.splice(i,1); writeDocs(a); renderDocs();
  });
  docsInput?.addEventListener('change', ()=>{
    const a=readDocs(); const kind=(docsKind && docsKind.value)||'';
    [...(docsInput.files||[])].forEach(f=>{
      if(a.length>=10) return;
      if(!(/pdf|image\//.test(f.type))){ alert(`Tip neacceptat: ${f.name}`); return; }
      if(f.size>5_000_000){ alert(`Fișier prea mare (>5MB): ${f.name}`); return; }
      a.push({name:f.name,sizeKB:Math.round(f.size/1024),type:f.type,mime:f.type,kind,ts:Date.now()});
    });
    writeDocs(a); docsInput.value=''; renderDocs();
  });

  function saveForms(){
    const t=Store.getItem('COLAB_TYPE')||'firma';
    if(t==='firma'){
      const data={
        categorie:catSel?.value||'',
        denumire: byId('firma-denumire')?.value||'',
        cui: byId('firma-cui')?.value||'',
        reg: byId('firma-reg')?.value||'',
        sediu: byId('firma-sediu')?.value||'',
        repr: byId('firma-repr')?.value||'',
        email: byId('firma-email')?.value||'',
        tel: byId('firma-tel')?.value||'',
        iban: byId('firma-iban')?.value||'',
        banca: byId('firma-banca')?.value||''
      };
      setJSON('FORM_FIRMA', data); return data;
    } else {
      const data={
        nume: byId('pf-nume2')?.value||'',
        cnp: byId('pf-cnp')?.value||'',
        adresa: byId('pf-adresa')?.value||'',
        email: byId('pf-email2')?.value||'',
        tel: byId('pf-tel')?.value||'',
        iban: byId('pf-iban')?.value||'',
        banca: byId('pf-banca')?.value||''
      };
      setJSON('FORM_PF', data); return data;
    }
  }
  function loadForms(){
    const t=Store.getItem('COLAB_TYPE')||'firma';
    if(t==='firma'){
      const d=getJSON('FORM_FIRMA',{});
      if(catSel && d.categorie) catSel.value=d.categorie;
      ['denumire','cui','reg','sediu','repr','email','tel','iban','banca'].forEach(k=>{
        const el=byId('firma-'+k); if(el) el.value=d[k]||'';
      });
    } else {
      const d=getJSON('FORM_PF',{});
      [['nume','pf-nume2'],['cnp','pf-cnp'],['adresa','pf-adresa'],['email','pf-email2'],['tel','pf-tel'],['iban','pf-iban'],['banca','pf-banca']]
        .forEach(([k,id])=>{ const el=byId(id); if(el) el.value=d[k]||''; });
    }
  }
  byId('form-save')?.addEventListener('click',()=>{ saveForms(); const m=byId('form-msg'); if(m){ m.textContent='Formular salvat.'; setTimeout(()=>m.textContent='',2000); } computeProgress(); });
  byId('form-gen')?.addEventListener('click',()=>{
    const t=Store.getItem('COLAB_TYPE')||'firma'; const today=new Date().toLocaleDateString('ro-RO');
    saveForms();
    let html='';
    if(t==='firma'){
      const d=getJSON('FORM_FIRMA',{}); const cat=d.categorie||'PFA';
      html=`<!doctype html><html><head><meta charset="utf-8"><title>Contract colaborare</title><style>body{font-family:Inter,Arial,sans-serif;padding:24px;line-height:1.45} h1{font-size:20px;color:#0e5a43} h2{font-size:16px;margin-top:18px}</style></head><body><h1>Contract de colaborare – ${cat}</h1><div>Data: ${today}</div><h2>Părți</h2><p><b>${d.denumire||'[denumire]'}</b>, ${cat}, CUI/CIF ${d.cui||'-'}, Reg. ${d.reg||'-'}, cu sediul în ${d.sediu||'-'}, reprezentată de ${d.repr||'-'}.</p><p>și Platforma „Bucătarul Personal”.</p><h2>Plăți</h2><p>IBAN: ${d.iban||'-'} • Banca: ${d.banca||'-'}</p><h2>Contact</h2><p>Email: ${d.email||'-'} • Tel: ${d.tel||'-'}</p><br><p>Semnături:</p><p>Colaborator: _____________ &nbsp;&nbsp; Platforma: _____________</p></body></html>`;
    } else {
      const d=getJSON('FORM_PF',{});
      html=`<!doctype html><html><head><meta charset="utf-8"><title>Contract colaborare PF</title><style>body{font-family:Inter,Arial,sans-serif;padding:24px;line-height:1.45} h1{font-size:20px;color:#0e5a43} h2{font-size:16px;margin-top:18px}</style></head><body><h1>Contract de colaborare – Persoană fizică</h1><div>Data: ${today}</div><h2>Părți</h2><p><b>${d.nume||'[nume complet]'}</b>, CNP ${d.cnp||'-'}, domiciliat(ă) în ${d.adresa||'-'}.</p><p>și Platforma „Bucătarul Personal”.</p><h2>Plăți</h2><p>IBAN: ${d.iban||'-'} • Banca: ${d.banca||'-'}</p><h2>Contact</h2><p>Email: ${d.email||'-'} • Tel: ${d.tel||'-'}</p><br><p>Semnături:</p><p>Colaborator: _____________ &nbsp;&nbsp; Platforma: _____________</p></body></html>`;
    }
    const w=window.open('about:blank','_blank');
    if(!w){ alert('Deblochează pop-up-urile pentru a vedea contractul.'); return; }
    w.document.write(html); w.document.close(); try{ w.focus(); w.print(); }catch(_){}
  });

  // === Galerie (demo) ===
  const gInput=byId('gal-upload'), gWrap=byId('gal-wrap'), gNote=byId('gal-note');
  function renderGal(){
    const arr=getJSON('GAL',[]);
    if(gWrap) gWrap.innerHTML=arr.map(s=>`<img src="${s}" style="width:100%;aspect-ratio:1/1;object-fit:cover;border-radius:12px;border:1px solid #e8ecee"/>`).join('');
    if(gNote) gNote.textContent = `${arr.length}/6 încărcate`;
    computeProgress();
  }
  gInput?.addEventListener('change',()=>{
    let arr=getJSON('GAL',[]);
    [...(gInput.files||[])].forEach(f=>{
      if(arr.length>=6) return;
      if(f.size>2_000_000){ alert(`"${f.name}" depășește 2MB.`); return; }
      const r=new FileReader(); r.onload=e=>{ arr.push(e.target.result); setJSON('GAL',arr); renderGal(); }; r.readAsDataURL(f);
    });
    gInput.value='';
  });
  renderGal();

  // === Tabele prețuri (PF) ===
  function bindCalc(prefix){
    const id = s => byId(`${prefix}-${s}`);
    const pers=id('pers'), prep=id('prep'), tarif=id('tarif'), comm=id('comm'), chef=id('chef'), total=id('total');
    if(!pers||!prep||!tarif||!comm||!chef||!total) return; // protecție
    const rec=()=>{
      const pp=+pers.value||0, nn=+prep.value||0, tt=+tarif.value||0, cc=(+comm.value||0)/100;
      const chefV=Math.max(0, pp*nn*tt); const tot=chefV*(1+cc);
      chef.value=fmt(chefV); total.value=fmt(tot); computeProgress();
    };
    [pers,prep,tarif,comm].forEach(el=>el.addEventListener('input',rec));
    rec();
  }
  ['fam','priv','corp'].forEach(bindCalc);

  // === Cereri + chat (demo) ===
  const reqList=byId('req-list'), chat=byId('chat'), chatInput=byId('chat-input');
  let reqs=getJSON('REQS',[]);
  if(!reqs.length){ reqs=[{id:'CER-9001',titlu:'Cină privată 6 pers',data:'2025-08-20',oras:'București',status:'pending',buget:2500}]; setJSON('REQS',reqs); }
  let active=reqs[0]?.id;
  function renderReqs(){
    if(!reqList) return;
    reqList.innerHTML=reqs.map(r=>`
      <div class="req-item ${r.id===active?'active':''}" data-id="${r.id}">
        <div><strong>${r.titlu}</strong><div class="note">${r.data} • ${r.oras} • ${fmtRON(r.buget)}</div></div>
        <span class="badge ${r.status}">${r.status}</span>
      </div>`).join('');
  }
  function openReq(id){
    active=id; renderReqs();
    const msgs=getJSON('CHAT_'+id,[]);
    if(chat) chat.innerHTML=msgs.map(m=>`<div class="msg ${m.me?'me':'them'}">${m.text}</div>`).join('');
    if(chat) chat.scrollTop=chat.scrollHeight;
  }
  reqList?.addEventListener('click', e=>{
    const it=e.target.closest('.req-item'); if(!it) return; openReq(it.dataset.id);
  });
  renderReqs(); if(active) openReq(active);
  byId('chat-send')?.addEventListener('click',()=>{
    const t=(chatInput?.value||'').trim(); if(!t || !active) return;
    const k='CHAT_'+active; const arr=getJSON(k,[]); arr.push({me:true,text:t,ts:Date.now()}); setJSON(k,arr);
    if(chatInput) chatInput.value=''; openReq(active);
  });

  // === Financiar ===
  const bankName=byId('bank-name'), bankIban=byId('bank-iban'), bankMsg=byId('bank-msg');
  byId('bank-save')?.addEventListener('click',()=>{
    const name=(bankName?.value||'').trim();
    const iban=(bankIban?.value||'').trim().toUpperCase();
    if(!name){ if(bankMsg) bankMsg.textContent='Introdu numele băncii.'; return; }
    if(!isValidRomanianIBAN(iban)){ if(bankMsg) bankMsg.textContent='IBAN invalid.'; return; }
    setJSON('BANK_META',{name,iban_mask: iban.replace(/\s+/g,'').replace(/^(.{6}).+(.{4})$/,'$1••••••••••••$2')});
    if(bankMsg) bankMsg.textContent='Date bancare salvate. (IBAN mascat)';
    computeProgress();
  });

  // === Progress ===
  function computeProgress(){
    let total=6, ok=0; const tips=[];
    // 1) Portret
    if(Store.getItem('PORTRAIT')) ok++; else tips.push('Încarcă portretul în tunica oficială.');
    // 2) Date profil
    const pd=getJSON('PROFILE_DATA',{});
    const profileOK = (pd.nume?.trim() && pd.prenume?.trim() && isValidEmail(pd.email) && (pd.descriere||'').trim().length>=30);
    if(profileOK) ok++; else tips.push('Completează profilul (nume, prenume, e-mail valid, descriere ≥ 30).');
    // 3) Colaborare + documente
    const type=Store.getItem('COLAB_TYPE')||'';
    let docsArr=[];
    if(type==='firma' || type==='fara'){
      try{ docsArr = JSON.parse(Store.getItem(type==='firma' ? 'DOCS_FIRMA' : 'DOCS_PF') || '[]'); }catch(_){ docsArr=[]; }
    }
    let collabOK=false;
    if(type==='firma'){
      const d=getJSON('FORM_FIRMA',{});
      collabOK=(d?.denumire?.trim() && d?.email && isValidEmail(d.email) && (docsArr?.length>0));
    } else if(type==='fara'){
      const d=getJSON('FORM_PF',{});
      const hasDiploma = Array.isArray(docsArr) && docsArr.some(x => (x.kind==='DIPLOMA') || /diplom|certificat/i.test(x.name||''));
      const hasCI = Array.isArray(docsArr) && docsArr.some(x => (x.kind==='CI') || /(CI|buletin|carte.*identitate|identitate|ID)/i.test(x.name||''));
      collabOK=(d?.nume?.trim() && d?.email && isValidEmail(d.email) && hasDiploma && hasCI);
    }
    if(collabOK) ok++; else tips.push(type==='fara' ? 'La „Modalități” (PF): formular + CI & Diplomă/Certificat.' : 'La „Modalități”: formular + 1 document.');
    // 4) Galerie
    const gal=getJSON('GAL',[]); if(gal.length>=6) ok++; else tips.push(`Încarcă 6 poze reale (ai ${gal.length}/6).`);
    // 5) Tabele prețuri (obligatoriu DOAR PF)
    const famPers=byId('fam-pers'), privPers=byId('priv-pers'), corpPers=byId('corp-pers');
    const famPrep=byId('fam-prep'), privPrep=byId('priv-prep'), corpPrep=byId('corp-prep');
    const famTarif=byId('fam-tarif'), privTarif=byId('priv-tarif'), corpTarif=byId('corp-tarif');
    const famOk = famPers && famPrep && famTarif && (+famPers.value>0 && +famPrep.value>0 && +famTarif.value>0);
    const privOk = privPers && privPrep && privTarif && (+privPers.value>0 && +privPrep.value>0 && +privTarif.value>0);
    const corpOk = corpPers && corpPrep && corpTarif && (+corpPers.value>0 && +corpPrep.value>0 && +corpTarif.value>0);
    if(type==='fara'){
      if(famOk && privOk && corpOk) ok++; else tips.push('Completează prețurile (Tradițional, Fine Dining, Premium) la PF.');
    } else { ok++; } // nu obligatoriu la firmă
    // 6) Bancă
    const bankName=(byId('bank-name')?.value||'').trim();
    const bankIban=(byId('bank-iban')?.value||'').trim();
    if(bankName && isValidRomanianIBAN(bankIban)) ok++; else tips.push('Adaugă banca + IBAN RO valid.');
    // UI
    const pct=Math.max(0, Math.min(100, Math.round(ok/total*100)));
    if(pb) pb.style.width=pct+'%';
    if(pl) pl.textContent=pct+'%';
    if(pt) pt.innerHTML=(pct===100)?'✅ Cont complet activat.':'Pași rămași: '+tips.join(' • ');
  }

  // === Init: arată secțiunea activă (implicit Profil) ===
  show('profil');
  computeProgress();
});
</script>
</body>
</html>

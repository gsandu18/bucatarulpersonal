<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard Bucătari – Profesional</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer"/>
  <style>
    :root{
      --verde:#0e5a43; --verde-2:#0b4a36; --text:#1c2226; --g1:#f6fbf8; --g2:#eef3ff; --b1:#fff; --b2:#e8ecee; --b3:#cfd6da; --warn:#fff3cd; --warn-text:#856404; --shadow:0 14px 46px rgba(0,0,0,.12);
    }
    *{box-sizing:border-box}
    html,body{margin:0}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--text);
      background:radial-gradient(1200px 600px at -10% -10%,var(--g2),#fff 40%),radial-gradient(900px 500px at 110% -20%,var(--g1),#fff 40%);
      min-height:100vh;
    }
    .container{width:min(1180px,94%);margin:auto;padding-bottom:48px}
    /* Tabs */
    .tabs{position:sticky;top:0;background:#ffffffc9;border-bottom:1px solid var(--b2);backdrop-filter:saturate(140%) blur(6px);
      z-index:10;display:flex;gap:10px;padding:12px 0;flex-wrap:wrap}
    .tab{padding:10px 14px;border:1px solid var(--b3);border-radius:999px;font-weight:700;background:#fff;cursor:pointer;user-select:none}
    .tab.active{border-color:var(--verde);color:var(--verde);box-shadow:0 6px 18px rgba(14,90,67,.18)}
    /* Cards */
    .card{background:#fff;border:1px solid var(--b2);border-radius:18px;padding:20px;box-shadow:var(--shadow);margin-top:18px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    @media(max-width:900px){.grid{grid-template-columns:1fr}}
    label{font-size:14px;font-weight:700}
    input,textarea,select{width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--b3);background:#fbfcfc}
    textarea{min-height:90px}
    .note{font-size:13px;color:#66707a}
    .warn{background:var(--warn);color:var(--warn-text);padding:10px 12px;border-radius:10px;font-weight:700;display:flex;gap:8px;align-items:center;margin:10px 0}
    /* Chat */
    .req-layout{display:grid;grid-template-columns:0.42fr 1fr;gap:16px}
    @media(max-width:900px){.req-layout{grid-template-columns:1fr}}
    .req-list{border:1px solid var(--b2);border-radius:12px;overflow:hidden;background:#fff}
    .req-item{padding:12px;border-bottom:1px solid var(--b2);cursor:pointer;display:flex;justify-content:space-between}
    .req-item.active{background:#f6fbf8;border-left:4px solid var(--verde)}
    .badge{font-size:12px;padding:4px 8px;border-radius:999px}
    .badge.pending{background:#fff7e6;color:#8a5b00}
    .badge.accepted{background:#eaf5ef;color:var(--verde-2)}
    .badge.closed{background:#eceff3;color:#555}
    .chat{border:1px solid var(--b2);border-radius:14px;display:flex;flex-direction:column;height:420px;background:#fff}
    .chat-messages{flex:1;overflow:auto;padding:12px;display:flex;flex-direction:column;gap:10px;background:#fafdfb}
    .msg{max-width:75%;padding:10px 12px;border-radius:12px}
    .msg.me{align-self:flex-end;background:var(--verde);color:#fff}
    .msg.them{align-self:flex-start;background:#eef5f1}
    .chat-input{display:flex;gap:8px;padding:10px;border-top:1px solid var(--b2)}
    .chat-input input{flex:1}
    /* Tables */
    .table{width:100%;border-collapse:separate;border-spacing:0 8px}
    .table th{background:var(--verde);color:#fff;text-align:left;padding:10px;border-radius:8px}
    .table td{background:#f6fbf8;padding:8px;border:1px solid #d1ded6}
    /* Financiar */
    .wallet{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px}
    .stat{border:1px solid var(--b2);border-radius:14px;padding:16px;background:linear-gradient(135deg,#f2faf5,#fff)}
    .stat strong{font-size:20px}
    /* Profile portrait */
    .portrait{display:flex;gap:16px;align-items:flex-start;flex-wrap:wrap}
    .portrait img{width:300px;height:300px;object-fit:cover;border-radius:10px;border:3px solid var(--verde);background:#ddd}
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);color:#fff;display:none;align-items:center;justify-content:center;text-align:center;padding:20px;font-size:18px;z-index:999}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:999px;border:1px solid var(--b3);background:#fff;font-weight:700;cursor:pointer}
    .btn.primary{background:var(--verde);border-color:transparent;color:#fff}
    /* Progress */
    .progress-card{display:flex;flex-direction:column;gap:8px}
    .progress-rail{height:12px;background:#eef3ef;border-radius:999px;overflow:hidden}
    .progress-bar{height:100%;width:0;background:linear-gradient(90deg,var(--verde),#23a576);transition:width .35s ease;border-radius:999px}
    .progress-head{display:flex;justify-content:space-between;align-items:center}
  </style>
</head>
<body>
<div class="container">
  <!-- Tabs -->
  <nav class="tabs" id="tabs">
    <span class="tab active" data-tab="profil">Profil</span>
    <span class="tab" data-tab="documente">Documente</span>
    <span class="tab" data-tab="galerie">Galerie</span>
    <span class="tab" data-tab="meniuri">Meniuri</span>
    <span class="tab" data-tab="cereri">Cereri</span>
    <span class="tab" data-tab="financiar">Financiar</span>
  </nav>

  <!-- Progress overall -->
  <section class="card progress-card" id="progress">
    <div class="progress-head">
      <strong>Progres profil</strong>
      <span id="progress-label">0%</span>
    </div>
    <div class="progress-rail"><div id="progress-bar" class="progress-bar"></div></div>
    <div id="progress-tips" class="note">Completează pașii pentru activare completă.</div>
  </section>

  <!-- PROFIL -->
  <section class="card section" id="profil">
    <h2>Profil – Portret obligatoriu</h2>
    <div class="warn"><i class="fa-solid fa-triangle-exclamation"></i> Poza trebuie să fie pătrată (min. 600×600px), <b>în tunica oficială Bucătarul Personal</b>. Se aplică automat un watermark transparent.</div>
    <div class="portrait">
      <img id="portraitPreview" src="https://via.placeholder.com/300x300.png?text=Portret" alt="Portret"/>
      <div>
        <div id="quality" class="note"></div>
        <input type="file" id="portraitUpload" accept="image/jpeg,image/png"/>
        <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
          <button id="cameraBtn" class="btn primary"><i class="fa-solid fa-camera"></i> Fă poză</button>
          <button id="removePortrait" class="btn"><i class="fa-solid fa-trash"></i> Șterge</button>
        </div>
        <div class="note" style="margin-top:10px">Opțional: încarcă <b>logo PNG</b> pentru watermark. <input type="file" id="wmUpload" accept="image/png"></div>
      </div>
    </div>
  </section>

  <!-- DOCUMENTE (CI complet) -->
  <section class="card section" id="documente" style="display:none">
    <h2>Documente • Carte de identitate</h2>
    <div class="warn"><i class="fa-solid fa-id-card-clip"></i> Completează toate datele din CI. (Demo: salvare locală)</div>
    <div class="grid">
      <div><label>Seria</label><input id="ci-seria" placeholder="RX"></div>
      <div><label>Număr</label><input id="ci-numar" placeholder="123456"></div>
      <div><label>CNP</label><input id="ci-cnp" placeholder="13 cifre"></div>
      <div><label>Nume</label><input id="ci-nume" placeholder="Nume"></div>
      <div><label>Prenume</label><input id="ci-prenume" placeholder="Prenume"></div>
      <div><label>Data nașterii</label><input id="ci-nastere" type="date"></div>
      <div><label>Eliberat la</label><input id="ci-eliberat" type="date"></div>
      <div><label>Valabil până</label><input id="ci-expira" type="date"></div>
      <div style="grid-column:1/-1"><label>Domiciliu</label><input id="ci-domiciliu" placeholder="Județ, Localitate, Str., nr."></div>
      <div><label>E-mail</label><input id="ci-email" type="email" placeholder="email@exemplu.ro"></div>
      <div><label>Telefon</label><input id="ci-telefon" placeholder="07xx xxx xxx"></div>
    </div>
    <div class="card" style="margin-top:12px">
      <div class="note">Încarcă scan/foto CI (PDF/JPG/PNG) – doar listare nume în demo.</div>
      <input type="file" id="ci-file" accept="application/pdf,image/*">
      <div id="ci-file-name" class="note">—</div>
      <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap">
        <button id="ci-save" class="btn primary"><i class="fa-solid fa-floppy-disk"></i> Salvează</button>
        <button id="ci-clear" class="btn"><i class="fa-solid fa-trash"></i> Șterge</button>
        <div id="ci-msg" class="note"></div>
      </div>
    </div>
  </section>

  <!-- GALERIE (6) -->
  <section class="card section" id="galerie" style="display:none">
    <h2>Galerie (maxim 6 poze)</h2>
    <div class="warn"><i class="fa-solid fa-triangle-exclamation"></i> Pozele trebuie să fie <b>reale</b>, nu copiate.</div>
    <input type="file" id="gal-upload" accept="image/*" multiple>
    <div id="gal-wrap" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px;margin-top:10px"></div>
    <div class="note" id="gal-note"></div>
  </section>

  <!-- MENIURI – Tradițional / Fine Dining / Premium -->
  <section class="card section" id="meniuri" style="display:none">
    <h2>Meniuri & calcule</h2>
    <p class="note">preț bucătar = persoane × preparate × tarif → total client = preț bucătar × (1 + comision/100)</p>
    <div class="grid">
      <div class="card">
        <h3><i class="fa-solid fa-bowl-food"></i> Tradițional</h3>
        <table class="table"><thead><tr><th>Nr. persoane</th><th>Nr. preparate</th><th>Tarif</th><th>Comision (%)</th><th>Preț bucătar</th><th>Total client</th></tr></thead>
          <tbody><tr>
            <td><input type="number" id="fam-pers" value="10"></td>
            <td><input type="number" id="fam-prep" value="5"></td>
            <td><input type="number" id="fam-tarif" value="35"></td>
            <td><input type="number" id="fam-comm" value="20"></td>
            <td><input type="text" id="fam-chef" readonly></td>
            <td><input type="text" id="fam-total" readonly></td>
          </tr></tbody>
        </table>
      </div>
      <div class="card">
        <h3><i class="fa-solid fa-champagne-glasses"></i> Fine Dining</h3>
        <table class="table"><thead><tr><th>Nr. persoane</th><th>Nr. preparate</th><th>Tarif</th><th>Comision (%)</th><th>Preț bucătar</th><th>Total client</th></tr></thead>
          <tbody><tr>
            <td><input type="number" id="priv-pers" value="6"></td>
            <td><input type="number" id="priv-prep" value="4"></td>
            <td><input type="number" id="priv-tarif" value="60"></td>
            <td><input type="number" id="priv-comm" value="20"></td>
            <td><input type="text" id="priv-chef" readonly></td>
            <td><input type="text" id="priv-total" readonly></td>
          </tr></tbody>
        </table>
      </div>
      <div class="card">
        <h3><i class="fa-solid fa-crown"></i> Premium</h3>
        <table class="table"><thead><tr><th>Nr. persoane</th><th>Nr. preparate</th><th>Tarif</th><th>Comision (%)</th><th>Preț bucătar</th><th>Total client</th></tr></thead>
          <tbody><tr>
            <td><input type="number" id="corp-pers" value="20"></td>
            <td><input type="number" id="corp-prep" value="6"></td>
            <td><input type="number" id="corp-tarif" value="45"></td>
            <td><input type="number" id="corp-comm" value="15"></td>
            <td><input type="text" id="corp-chef" readonly></td>
            <td><input type="text" id="corp-total" readonly></td>
          </tr></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- CERERI + CHAT (demo) -->
  <section class="card section" id="cereri" style="display:none">
    <h2>Cererile mele</h2>
    <div class="req-layout">
      <aside class="req-list" id="req-list"></aside>
      <div class="chat">
        <div class="chat-messages" id="chat"></div>
        <div class="chat-input"><input id="chat-input" placeholder="Scrie un mesaj..."><button id="chat-send" class="btn primary"><i class="fa-solid fa-paper-plane"></i> Trimite</button></div>
      </div>
    </div>
  </section>

  <!-- FINANCIAR -->
  <section class="card section" id="financiar" style="display:none">
    <h2>Financiar</h2>
    <div class="wallet">
      <div class="stat"><div class="note">Credit disponibil</div><strong id="credit">5 000 lei</strong></div>
      <div class="stat"><div class="note">Sold curent</div><strong id="sold">0 lei</strong></div>
      <div class="stat"><div class="note">Plăți recente</div><div id="payments" class="note">—</div></div>
    </div>
    <div class="card" style="margin-top:12px">
      <h3 style="margin:0 0 8px">Cont bancar</h3>
      <div class="grid">
        <div><label>Nume bancă</label><input id="bank-name" placeholder="BCR / BT / ING"></div>
        <div><label>IBAN</label><input id="bank-iban" placeholder="ROxx BANK xxxx xxxx xxxx xxxx"></div>
      </div>
      <div style="margin-top:10px;display:flex;gap:10px;align-items:center">
        <button id="bank-save" class="btn primary"><i class="fa-solid fa-floppy-disk"></i> Salvează</button>
        <div id="bank-msg" class="note"></div>
      </div>
    </div>
  </section>
</div>

<div id="overlay" class="overlay">⚠️ Trebuie să încarci o poză de portret validă pentru a continua în dashboard.</div>

<script>
(()=>{
  // ==== Safe storage
  const Store = (()=>{try{const t='__t__';localStorage.setItem(t,'1');localStorage.removeItem(t);return localStorage;}catch(e){const mem={};return{getItem:k=>mem[k]||null,setItem:(k,v)=>mem[k]=String(v),removeItem:k=>delete mem[k]};}})();
  const getJSON=(k,d)=>{try{const v=Store.getItem(k);return v?JSON.parse(v):d}catch(e){return d}};
  const setJSON=(k,v)=>{try{Store.setItem(k,JSON.stringify(v))}catch(e){}};

  const nf=new Intl.NumberFormat('ro-RO');
  const fmt=n=>nf.format(Math.round(+n||0));
  const fmtRON=n=>fmt(n)+' lei';

  // ===== Progress =====
  const pb=document.getElementById('progress-bar');
  const pl=document.getElementById('progress-label');
  const pt=document.getElementById('progress-tips');
  function computeProgress(){
    let total=5, ok=0; const tips=[];
    // 1) Portret
    const portrait=Store.getItem('PORTRAIT');
    if(portrait){ ok++; } else { tips.push('Încarcă portretul în tunica oficială.'); }
    // 2) CI complet + valid
    const ci=getJSON('CI',{});
    const required=['seria','numar','cnp','nume','prenume','nastere','eliberat','expira','domiciliu','email','telefon'];
    const ciFilled=required.every(k=> (ci[k]||'').trim().length>0) && /^\d{13}$/.test(ci.cnp||'') && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(ci.email||'');
    if(ciFilled){ ok++; } else { tips.push('Completează toate câmpurile din CI.'); }
    // 3) Galerie: 6 poze
    const gal=getJSON('GAL',[]); if(gal.length>=6){ ok++; } else { tips.push(`Încarcă 6 poze reale (ai ${gal.length}/6).`); }
    // 4) Meniuri: toate 3 categorii cu valori >0
    const famOk=(+document.getElementById('fam-pers').value>0 && +document.getElementById('fam-prep').value>0 && +document.getElementById('fam-tarif').value>0);
    const privOk=(+document.getElementById('priv-pers').value>0 && +document.getElementById('priv-prep').value>0 && +document.getElementById('priv-tarif').value>0);
    const corpOk=(+document.getElementById('corp-pers').value>0 && +document.getElementById('corp-prep').value>0 && +document.getElementById('corp-tarif').value>0);
    if(famOk && privOk && corpOk){ ok++; } else { tips.push('Completează prețurile la Tradițional, Fine Dining și Premium.'); }
    // 5) Financiar: nume bancă + IBAN valid
    const bank=getJSON('BANK',{}); if((bank.name||'').trim() && /^RO[0-9A-Z]{16,}$/.test((bank.iban||''))){ ok++; } else { tips.push('Adaugă numele băncii și un IBAN valid.'); }

    const pct=Math.round(ok/total*100);
    pb.style.width=pct+'%'; pl.textContent=pct+'%';
    pt.innerHTML = (pct===100) ? '✅ Cont complet activat.' : 'Pași rămași: ' + tips.join(' • ');
  }

  // ===== Tabs + blocare până la portret valid
  let hasValidPortrait=false;
  const tabs=document.getElementById('tabs');
  const sections={profil:'profil',documente:'documente',galerie:'galerie',meniuri:'meniuri',cereri:'cereri',financiar:'financiar'};
  function show(id){ Object.values(sections).forEach(s=>document.getElementById(s).style.display='none'); document.getElementById(id).style.display='block'; }
  tabs.addEventListener('click',e=>{ const t=e.target.closest('.tab'); if(!t) return; if(!hasValidPortrait && t.dataset.tab!=='profil'){ document.getElementById('overlay').style.display='flex'; return; } tabs.querySelectorAll('.tab').forEach(b=>b.classList.remove('active')); t.classList.add('active'); show(sections[t.dataset.tab]); });

  // ===== Profil: upload/cameră + watermark
  const portraitPreview=document.getElementById('portraitPreview');
  const portraitUpload=document.getElementById('portraitUpload');
  const removePortrait=document.getElementById('removePortrait');
  const qualityEl=document.getElementById('quality');
  const overlay=document.getElementById('overlay');
  const wmUpload=document.getElementById('wmUpload');

  let wmLogoData=getJSON('WM_LOGO', null); // PNG dataURL sau null
  wmUpload.addEventListener('change',()=>{ const f=wmUpload.files[0]; if(!f) return; const r=new FileReader(); r.onload=e=>{ wmLogoData=e.target.result; Store.setItem('WM_LOGO', wmLogoData); alert('Logo watermark salvat.'); }; r.readAsDataURL(f); });

  function checkQuality(imgW,imgH){
    if(imgW<600||imgH<600){ qualityEl.textContent='Calitate: Slabă (minim 600×600px)'; qualityEl.style.color='#dc3545'; return false; }
    const ratio=imgW/imgH; if(ratio<0.8||ratio>1.2){ qualityEl.textContent='Calitate: Acceptabilă (nu este pătrată)'; qualityEl.style.color='#e69500'; return false; }
    qualityEl.textContent='Calitate: Bună'; qualityEl.style.color='#198754'; return true;
  }
  function cropToSquare(img){ const size=Math.min(img.width,img.height); const sx=(img.width-size)/2, sy=(img.height-size)/2; const c=document.createElement('canvas'); c.width=c.height=size; const ctx=c.getContext('2d'); ctx.drawImage(img,sx,sy,size,size,0,0,size,size); return c; }
  function drawWatermark(canvas){ const ctx=canvas.getContext('2d'); ctx.save(); ctx.globalAlpha=0.22; ctx.translate(canvas.width/2, canvas.height/2); ctx.rotate(-Math.PI/6); ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillStyle='#0e5a43'; ctx.font=Math.round(canvas.width*0.08)+'px Inter, Arial'; ctx.fillText('BUCĂTARUL PERSONAL', 0, 0); ctx.restore(); if(wmLogoData){ const img=new Image(); img.onload=()=>{ const w=Math.min(canvas.width*0.28, img.width); const h=w*(img.height/img.width); ctx.save(); ctx.globalAlpha=0.35; ctx.drawImage(img, canvas.width-w-14, canvas.height-h-14, w, h); ctx.restore(); }; img.src=wmLogoData; } }
  function processPortrait(dataURL){ const img=new Image(); img.onload=()=>{ const validBase=checkQuality(img.naturalWidth,img.naturalHeight); const squareCanvas=cropToSquare(img); const out=document.createElement('canvas'); out.width=out.height=900; const octx=out.getContext('2d'); octx.drawImage(squareCanvas,0,0,900,900); drawWatermark(out); const finalData=out.toDataURL('image/png'); portraitPreview.src=finalData; Store.setItem('PORTRAIT', finalData); hasValidPortrait = validBase && true; overlay.style.display = hasValidPortrait ? 'none' : 'flex'; computeProgress(); }; img.src=dataURL; }
  const savedPortrait=Store.getItem('PORTRAIT'); if(savedPortrait){ portraitPreview.src=savedPortrait; hasValidPortrait=true; overlay.style.display='none'; qualityEl.textContent='Calitate: Bună'; qualityEl.style.color='#198754'; } else { overlay.style.display='flex'; }
  portraitUpload.addEventListener('change',()=>{ const f=portraitUpload.files[0]; if(!f) return; if(!/image\/(png|jpeg)/.test(f.type)){ alert('Acceptăm doar JPG/PNG'); return; } const r=new FileReader(); r.onload=e=>processPortrait(e.target.result); r.readAsDataURL(f); });
  removePortrait.addEventListener('click',()=>{ Store.removeItem('PORTRAIT'); portraitPreview.src='https://via.placeholder.com/300x300.png?text=Portret'; hasValidPortrait=false; overlay.style.display='flex'; qualityEl.textContent=''; computeProgress(); });
  document.getElementById('cameraBtn').addEventListener('click', async()=>{ try{ const stream=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1920},height:{ideal:1080}}}); const video=document.createElement('video'); video.srcObject=stream; await video.play(); setTimeout(()=>{ const c=document.createElement('canvas'); c.width=c.height=900; const ctx=c.getContext('2d'); const side=Math.min(video.videoWidth,video.videoHeight); const sx=(video.videoWidth-side)/2; const sy=(video.videoHeight-side)/2; ctx.drawImage(video, sx, sy, side, side, 0,0,900,900); drawWatermark(c); const data=c.toDataURL('image/png'); processPortrait(data); stream.getTracks().forEach(t=>t.stop()); }, 1000); }catch(err){ alert('Camera indisponibilă: '+err.message); } });

  // ===== Documente (CI)
  const ciFields=['seria','numar','cnp','nume','prenume','nastere','eliberat','expira','domiciliu','email','telefon'];
  const ciEls={}; ciFields.forEach(f=> ciEls[f]=document.getElementById('ci-'+f));
  const ciData=getJSON('CI',{}); Object.entries(ciEls).forEach(([k,el])=>{ if(el && ciData[k]) el.value=ciData[k]; });
  const ciFile=document.getElementById('ci-file'); const ciFileName=document.getElementById('ci-file-name'); if(ciFile){ ciFile.addEventListener('change',()=>{ ciFileName.textContent=ciFile.files[0]?ciFile.files[0].name:'—'; }); }
  document.getElementById('ci-save').addEventListener('click',()=>{ const d={}; ciFields.forEach(f=> d[f]=(ciEls[f]?.value||'').trim()); if(d.cnp && !/^\d{13}$/.test(d.cnp)) return (document.getElementById('ci-msg').textContent='CNP invalid.'); if(d.email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d.email)) return (document.getElementById('ci-msg').textContent='Email invalid.'); setJSON('CI',d); document.getElementById('ci-msg').textContent='Salvat.'; computeProgress(); });
  document.getElementById('ci-clear').addEventListener('click',()=>{ Store.removeItem('CI'); Object.values(ciEls).forEach(el=> el && (el.value='')); document.getElementById('ci-msg').textContent='Șters.'; computeProgress(); });

  // ===== Galerie (6)
  const gInput=document.getElementById('gal-upload'); const gWrap=document.getElementById('gal-wrap'); const gNote=document.getElementById('gal-note');
  function renderGal(){ const arr=getJSON('GAL',[]); gWrap.innerHTML=arr.map(s=>`<img src="${s}" style="width:100%;aspect-ratio:1/1;object-fit:cover;border-radius:12px;border:1px solid #e8ecee"/>`).join(''); gNote.textContent=`${arr.length}/6 încărcate`; computeProgress(); }
  if(gInput){ gInput.addEventListener('change',()=>{ let arr=getJSON('GAL',[]); [...gInput.files].forEach(f=>{ if(arr.length>=6) return; const r=new FileReader(); r.onload=e=>{ arr.push(e.target.result); setJSON('GAL',arr); renderGal(); }; r.readAsDataURL(f); }); gInput.value=''; }); renderGal(); }

  // ===== Meniuri calc
  function bindCalc(p){ const id=s=>document.getElementById(`${p}-${s}`); const pers=id('pers'),prep=id('prep'),tarif=id('tarif'),comm=id('comm'),chef=id('chef'),total=id('total'); const rec=()=>{ const pp=+pers.value||0, nn=+prep.value||0, tt=+tarif.value||0, cc=(+comm.value||0)/100; const chefV=Math.max(0,pp*nn*tt); const tot=chefV*(1+cc); chef.value=fmt(chefV); total.value=fmt(tot); computeProgress(); }; [pers,prep,tarif,comm].forEach(el=>el&&el.addEventListener('input',rec)); rec(); }
  ['fam','priv','corp'].forEach(bindCalc);

  // ===== Cereri + chat (demo)
  const reqList=document.getElementById('req-list'); const chat=document.getElementById('chat'); const chatInput=document.getElementById('chat-input');
  let reqs=getJSON('REQS',[]); if(!reqs.length){ reqs=[{id:'CER-9001',titlu:'Cină privată 6 pers',data:'2025-08-20',oras:'București',status:'pending',buget:2500}]; setJSON('REQS',reqs); }
  let active=reqs[0].id; function renderReqs(){ reqList.innerHTML=reqs.map(r=>`<div class="req-item ${r.id===active?'active':''}" data-id="${r.id}"><div><strong>${r.titlu}</strong><div class="note">${r.data} • ${r.oras} • ${fmtRON(r.buget)}</div></div><span class="badge ${r.status}">${r.status}</span></div>`).join(''); }
  function openReq(id){ active=id; renderReqs(); const msgs=getJSON('CHAT_'+id,[]); chat.innerHTML=msgs.map(m=>`<div class="msg ${m.me?'me':'them'}">${m.text}</div>`).join(''); chat.scrollTop=chat.scrollHeight; }
  reqList.addEventListener('click',e=>{ const it=e.target.closest('.req-item'); if(!it) return; openReq(it.dataset.id); }); renderReqs(); openReq(active);
  document.getElementById('chat-send').addEventListener('click',()=>{ const t=(chatInput.value||'').trim(); if(!t) return; const k='CHAT_'+active; const arr=getJSON(k,[]); arr.push({me:true,text:t,ts:Date.now()}); setJSON(k,arr); chatInput.value=''; openReq(active); });

  // ===== Financiar – bancă + IBAN
  const bankName=document.getElementById('bank-name'); const bankIban=document.getElementById('bank-iban'); const bankMsg=document.getElementById('bank-msg');
  const bank=getJSON('BANK',{}); if(bank.name) bankName.value=bank.name; if(bank.iban) bankIban.value=bank.iban;
  document.getElementById('bank-save').addEventListener('click',()=>{ const name=(bankName.value||'').trim(); const iban=(bankIban.value||'').trim().toUpperCase(); if(!name){bankMsg.textContent='Introdu numele băncii.';return;} if(!/^RO[0-9A-Z]{16,}$/.test(iban)){bankMsg.textContent='IBAN invalid (ex: RO49 AAAA 1B31 0075 9384 0000)';return;} setJSON('BANK',{name,iban}); bankMsg.textContent='Date bancare salvate.'; computeProgress(); });

  // initial
  computeProgress();
})();
</script>
</body>
</html>
